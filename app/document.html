<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <title>Document</title>
</head>

<body>
    <div class="modal hidden" id="position-modal">
        <div class="card">
            <p>posiziona la carta sotto al sensore</p>
            <button>fatto</button>
        </div>
    </div>
    <div class="modal hidden" id="response-modal">
        <div class="card">
            <div class="fields">
                <fieldset id="name-field">
                    <legend>Nome</legend>
                    <input type="text" name="" id="name-input">
                </fieldset>
                <fieldset id="nation-field">
                    <legend>Nazionalit&agrave;</legend>
                    <input type="text" name="" id="nation-input">
                </fieldset>
                <fieldset id="sex-field">
                    <legend>Sesso</legend>
                    <input type="text" name="" id="sex-input">
                </fieldset>
                <fieldset id="cf-field">
                    <legend>CF</legend>
                    <input type="text" name="" id="code-input">
                </fieldset>
            </div>
            <button id="step-2-btn">Avanti</button>
        </div>
    </div>
    </div>
    <div class="main-container">
        <div class="flex-container">
            <button>Carta Identit√†</button>
            <button>Passaporto</button>
            <button>Patente</button>
            <button>Tessera Sanitaria</button>
        </div>
    </div>

    <script>
        $('.flex-container button').click(() => {
            $('#position-modal').removeClass('hidden');
        })

        $('#position-modal button').click(() => {
            $.get("../core/operation.php", {
                op: "barcode"
            }, ).done((message) => {
                console.log(`message1: ${message}`);
                $('#cf-field input').text(message);

                $.get("../core/operation.php", {
                    op: "info",
                    type: "id"
                }, ).done((message) => {
                    console.log(`message: ${message}`);
                    if (!(message != 'error')) {
                        console.log(`errore scanner`);
                        // TODO impostare i dati a mano
                    } else {
                        message = JSON.parse(message);

                        console.log(`message2: ${message}`);
                        $('#name-field input').text(message[0] + ' ' + message[1]);
                        $('#nation-field input').text(message[3]);
                        $('#sex-field input').text(message[2]);

                    }
                    $('#position-modal').addClass('hidden');
                    $('#response-modal').removeClass('hidden');
                })
            })
        })

        $('#response-modal button').click(() => {
            // $('#response-modal').addClass('hidden');
            localStorage.setItem('name', $('#name-input').val());
            localStorage.setItem('nation', $('#nation-input').val())
            localStorage.setItem('sex', $('#sex-input').val())
            localStorage.setItem('code', $('#code-input').val())

            window.location = './picture.html';
        })

        saveData = function () {
            $.post("../core/operation.php", {
                op: "saveData",
                name: localStorage.getItem('name'),
                nation: localStorage.getItem('nation'),
                sex: localStorage.getItem('sex'),
                code: localStorage.getItem('code'),
            }).done((message) => {
                console.log(`message: ${message}`);
                // window.location = 'index.html';
            })
        }
    </script>
</body>

</html>